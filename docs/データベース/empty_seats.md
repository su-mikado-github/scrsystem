# 空き座席 (empty_seats)

## テーブル情報

| 項目                           | 値                                                                                                   |
|:-------------------------------|:-----------------------------------------------------------------------------------------------------|
| システム名                     | 学食予約システム                                                                                     |
| サブシステム名                 |                                                                                                      |
| 論理エンティティ名             | 空き座席                                                                                             |
| 物理エンティティ名             | empty_seats                                                                                          |
| 作成者                         | Shuji Ushiyama                                                                                       |
| 作成日                         | 2023/09/10                                                                                           |
| タグ                           | ビュー                                                                                               |



## カラム情報

| No. | 論理名                         | 物理名                         | データ型                       | Not Null | デフォルト           | 備考                           |
|----:|:-------------------------------|:-------------------------------|:-------------------------------|:---------|:---------------------|:-------------------------------|
|   1 | 座席ID                         | seat_id                        |                                |          |                      |                                |
|   2 | 座席番号                       | seat_no                        |                                |          |                      |                                |
|   3 | 座席グループ番号               | seat_group_no                  |                                |          |                      |                                |
|   4 | カレンダーID                   | calendar_id                    |                                |          |                      |                                |
|   5 | 日付                           | date                           |                                |          |                      |                                |
|   6 | 年                             | year                           |                                |          |                      |                                |
|   7 | 月                             | month                          |                                |          |                      |                                |
|   8 | 日                             | day                            |                                |          |                      |                                |
|   9 | 曜日                           | weekday                        |                                |          |                      |                                |
|  10 | 時刻ID                         | time_id                        |                                |          |                      |                                |
|  11 | 時                             | hour                           |                                |          |                      |                                |
|  12 | 分                             | minute                         |                                |          |                      |                                |
|  13 | 時刻                           | time                           |                                |          |                      |                                |
|  14 | 時刻(分)                       | time_minutes                   |                                |          |                      |                                |



## ソース
```
SELECT
    T.id AS seat_id -- 座席ID
    , T.seat_no -- 座席番号
    , T.seat_group_no -- 座席グループ番号
    , T1.id AS calendar_id -- カレンダーID
    , T1.date -- 日付
    , T1.year -- 年
    , T1.month -- 月
    , T1.day -- 日
    , T1.weekday -- 曜日
    , T2.id AS time_id -- 時刻ID
    , T2.hour -- 時
    , T2.minute -- 分
    , T2.time -- 時刻
    , T2.time_minutes -- 時刻(分)
FROM
    seats T 
    INNER JOIN calendars T1 ON (
        T1.is_delete = 0
    )
    INNER JOIN times T2 ON (
        T2.is_delete = 0
    )
WHERE
    T.is_delete = 0
    AND NOT EXISTS (
        SELECT
            *
        FROM
            reserves S1T
            INNER JOIN reserve_seats S1T1 ON (
                S1T1.is_delete = 0
                AND S1T1.reserve_id = S1T.id
            )
        WHERE
            S1T.is_delete = 0
            AND S1T.date = T1.date
            AND S1T.time <= T2.time
            AND S1T.end_time >= T2.time
            AND S1T1.seat_id = T.id
    )


```



## インデックス情報

| No. | インデックス名                 | カラムリスト                             | ユニーク   | オプション                     | 
|----:|:-------------------------------|:-----------------------------------------|:-----------|:-------------------------------|



## リレーションシップ情報

| No. | 動詞句                         | カラムリスト                             | 参照先                         | 参照先カラムリスト                       |
|----:|:-------------------------------|:-----------------------------------------|:-------------------------------|:-----------------------------------------|
|   1 |                                | time_id                                  | times                          | id                                       |
|   2 |                                | calendar_id                              | calendars                      | id                                       |
|   3 |                                | seat_id                                  | seats                          | id                                       |



## リレーションシップ情報(PK側)

| No. | 動詞句                         | カラムリスト                             | 参照元                         | 参照元カラムリスト                       |
|----:|:-------------------------------|:-----------------------------------------|:-------------------------------|:-----------------------------------------|


